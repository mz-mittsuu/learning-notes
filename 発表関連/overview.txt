am62x evm board を用いた組込みシステム開発
Ubuntu-22.04
ti-processor-sdk-linux-am62xx-evm-11.02.08.02
cpp-httplibs
REST API

host PC で build ->
ssh root@192.168.10.2 接続し bin を scp で evm board に転送 ->
evm board 上で実行 (systemd service化) ->
host PC の webブラウザから dashboard.html を閲覧

temp は UI からではなく別途センサープログラムから与えられる設計

== POST (temp) ==
"Web Dashboard (UI)" -> "Device API" : Submit temp (POST /sensor/{temp})
"Device API" -> "Alarm Controller" : Update temp
"Alarm Controller" -> "Alarm Controller" : Decide LED mode from temp
"Alarm Controller" -> "LED Driver" : Apply LED mode
"LED Driver" -> "Linux LED Interface" : Write LED setting
"Linux LED Interface" -> "On-board LED (hardware)" : Change new LED behavior

== GET (LED) ==
"Web Dashboard (UI)" -> "Device API" : Request LED (GET /sensor/led)
"Device API" -> "Alarm Controller" : Read LED
"Alarm Controller" --> "Device API" : LED
"Device API" --> "Web Dashboard (UI)" : LED

== GET (temp) ==
"Web Dashboard (UI)" -> "Device API" : Request temp (GET /sensor/temp)
"Device API" -> "Alarm Controller" : Read temp
"Alarm Controller" --> "Device API" : temp
"Device API" --> "Web Dashboard (UI)" : temp


Decide LED mode from temp
if (sensorTemp <= 39) {
    ledStatus = 0;
} else if (sensorTemp <= 59) {
    ledStatus = 1;
} else if (sensorTemp <= 79) {
    ledStatus = 2;
} else {
    ledStatus = 3;
}

Apply LED mode
if (ledStatus == 0) {
    setOff();
} else if (ledStatus == 1) {
    blinkSlow();
} else if (ledStatus == 2) {
    blinkFast();
} else {
    setOn();
}

writeFile(const std::string& path, const std::string& value)
{
    std::ofstream ofs(path);
    if (!ofs) return false;
    ofs << value;
    return bool(ofs);
}
setOff()
{
    writeFile("/sys/class/leds/am62-sk:green:heartbeat/" + "trigger", "none");
    writeFile("/sys/class/leds/am62-sk:green:heartbeat/" + "brightness", "0");
}
blinkSlow()
{
    writeFile("/sys/class/leds/am62-sk:green:heartbeat/" + "trigger", "timer");
    writeFile("/sys/class/leds/am62-sk:green:heartbeat/" + "delay_on", "200");
    writeFile("/sys/class/leds/am62-sk:green:heartbeat/" + "delay_off", "800");
}
blinkFast()
{
    writeFile("/sys/class/leds/am62-sk:green:heartbeat/" + "trigger", "timer");
    writeFile("/sys/class/leds/am62-sk:green:heartbeat/" + "delay_on", "100");
    writeFile("/sys/class/leds/am62-sk:green:heartbeat/" + "delay_off", "100");
}
setOn()
{
    writeFile("/sys/class/leds/am62-sk:green:heartbeat/" + "trigger", "none");
    writeFile("/sys/class/leds/am62-sk:green:heartbeat/" + "brightness", "1");
}

/src/alarm/alarm.cpp // Alarm Controller に該当
/src/alarm/alarm.h // Alarm Controller に該当
/src/interface/main.cpp // Device API に該当
/src/led/LedControl.cpp // LED Driver に該当
/src/led/LedControl.h // LED Driver ("/sys/class/leds/am62-sk:green:heartbeat/"操作) に該当
/src/led/ILedControl.h // LED Driver (unittest mock用) に該当
/static/dashboard.html // Web Dashboard (UI) に該当

ちなみにtempの初期値は20、ledの初期値は0(OFF)
単体テストは済み

システムテスト項目としては
ST-01 起動確認 systemdで起動しているか
ST-02 static file に到達できるか
ST-03 初期値(POST/GET/SSH cat)
ST-04...09 境界値でPOSTに対するGET
ST-10...13 代表値でPOSTに対するSSH cat
ST-14...15 異常値でPOSTに対するGET
ST-16 バーストでPOSTに対するGETの状態

am62x evm が起動済み&SSH接続済みを前提にしたテストです
ローカル環境(host PC で bash に Python3 system_test/system_test.py)で確認済み
ログ収集は一応XML,JSON,LOGでbashに流れるものと同じものを保持しました(一旦gitignore)
azure DevOps を使ったクラウド環境でのシステムテストに移行する
pushされてvmで単体テストが通ったらam62x evmに接続済みのPCにシステムテストをやらせて、その結果をazure DevOpsでダッシュボード表示する仕組みする計画だったが、システムテスト時の実機のbinのバージョンがアップデートされてない状態でやることになってしまうので、デプロイ担当のLEEさんと相談中

まずはこれを覚えて



事前に提示された内容ここから

テーマ名
ソフトウェアデファインド組込みシステムを支えるDevOps技術の研究開発

内容
ソフトウェアデファインド技術を取り入れた組込みシステムでは、クラウドと連携した機能追加や運用・保守の継続的な改善が不可欠となっています。こうしたシステム開発の現場でも、DevOpsやクラウドサービスを活用することで、開発・運用プロセスの効率化や高付加価値化が強く期待されており、最新技術導入の研究開発が進んでいます。
本インターンシップでは、クラウド上のDevOps環境を活用し、ソフトウェアデファインドな組込みシステムの開発プロセスを支える技術開発に取り組みます。具体的には、CI/CDパイプラインの構築、自動テストやリリース管理、PaaS・SaaSとの連携など、組込みソフトのクラウドインテグレーションを推進する実践的な手法に携わります。

課題1 ソフトウェアの複雑化により不具合が多発し、品質担保が必須
    機能拡張のスピードが速い一方で、不具合発生リスク増加
    製品出荷後のアップデート(OTA)により、不具合が短時間でユーザ全体に広がる
    そのため高品質を継続的に確保する仕組みが不可欠
        静的解析/自動テスト/自動ビルド/コードレビューの標準化が必須
課題2 品質向上の手段としてDevOpsが注目されるが、組込みでは導入の壁がある
    DevOpsは本来自動化(CI/CD)で品質と開発速度を両立できる強力な手法
    しかし組込みならではの壁が存在
        クロスコンパイルやSDK依存が複雑
        実機がないと十分なテストができない
        ハードウェア依存の違いでクラウド上のテストが難しい
        ネットワーク・ストレージ製薬・実行環境がバラバラ

事前に提示された内容ここまで

スケジュール
Day1 オリエンテーション, PCセットアップ, アカウントセットアップ
Day2 開発環境を構築し、hostPC から AM62x EVM を接続する
    WSL(Ubuntu)
    VSCode
    TI SDK
    AM62x EVM のシリアル接続, イーサネット接続
    サンプルアプリのビルド, 動作確認
Day3 開発するアプリの方向性・分担を決めアプリの開発に着手
    開発計画・分担
    アプリの要件定義, 基本設計, 詳細設計
    アプリの実装
Day4 アプリの実装を完成させ単体テストに着手
    アプリ開発・動作確認
    gteat, gcovr の環境構築
    gtest を用いた単体テストコード作成
    単体テスト・カバレッジ評価の導入
Day5 アプリの実装改善, 単体テスト・カバレッジ評価の適用
    アプリのソフトウェア構成見直し
    アプリの実装改善
    単体テスト・カバレッジ評価の導入
    アプリのサービス化(systemd で自動起動)
Day6 クラウド(Azure DebOps)をもちいてのビルド・単体テスト・カバレッジ評価を実施
    pipeline の作成
    pipeline の動作確認
    単体テスト・カバレッジ評価の結果確認
Day7 システムテスト・自動デプロイの手順、実現方法を整理し、ローカルで実行
    システムテスト(水谷)
        テスト対象・テスト項目・テスト判定の整理
    自動デプロイ(LEE)
        自動デプロイの手順、実現方法の整理
Day8
    システムテストの動作確認(予定)
    自動デプロイの動作確認(予定)
    報告資料の作成(予定)
Day9
    システムテストの動作確認(予定)
    自動デプロイの動作確認(予定)
    報告資料の作成(予定)
    内部レビュー(予定)
Day10
    成果報告会(予定)

Day6まで共同作業
Day7以降は分担(システムテスト:水谷, 自動デプロイ:LEE)

成果報告会発表資料について意識してほしいといわれたこと
各セクションで言いたいこと
ストーリー設定
各スライドのメインポイント
スライドのつながり
ストーリーの流れ
担当箇所の課題・アプローチ
提示された内容をそのまま書くのではなく、自分の担当した箇所にも少しフォーカスを当ててほしいとのこと

システムの構成・実装・単体テストなどはLEEさんと重複する箇所はもちろんあってもよいが、その中で自分の担当箇所は強調して話してほしいと言われた
LEEさんは自動デプロイを担当したのでDevOpsメインで話す予定らしい
わたしはシステムテストを担当した
発表15分 質疑5分

報告のアウトライン(Word)を作成しなければならない
構成の例(変更可)
0.タイトル
1.背景
2.課題
3.解決方法
4.結果
5.考察
6.まとめ