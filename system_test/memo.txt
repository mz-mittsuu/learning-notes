am62x evm board を用いた組込みシステム開発
Ubuntu-22.04
ti-processor-sdk-linux-am62xx-evm-11.02.08.02
cpp-httplibs
REST API

host PC で build ->
ssh root@192.168.10.2 接続し bin を scp で evm board に転送 ->
evm board 上で実行 (systemd service化) ->
host PC の webブラウザから dashboard.html を閲覧

temp は UI からではなく別途センサープログラムから与えられる設計

== POST (temp) ==
"Web Dashboard (UI)" -> "Device API" : Submit temp (POST /sensor/{temp})
"Device API" -> "Alarm Controller" : Update temp
"Alarm Controller" -> "Alarm Controller" : Decide LED mode from temp
"Alarm Controller" -> "LED Driver" : Apply LED mode
"LED Driver" -> "Linux LED Interface" : Write LED setting
"Linux LED Interface" -> "On-board LED (hardware)" : Change new LED behavior

== GET (LED) ==
"Web Dashboard (UI)" -> "Device API" : Request LED (GET /sensor/led)
"Device API" -> "Alarm Controller" : Read LED
"Alarm Controller" --> "Device API" : LED
"Device API" --> "Web Dashboard (UI)" : LED

== GET (temp) ==
"Web Dashboard (UI)" -> "Device API" : Request temp (GET /sensor/temp)
"Device API" -> "Alarm Controller" : Read temp
"Alarm Controller" --> "Device API" : temp
"Device API" --> "Web Dashboard (UI)" : temp


Decide LED mode from temp
if (sensorTemp <= 39) {
    ledStatus = 0;
} else if (sensorTemp <= 59) {
    ledStatus = 1;
} else if (sensorTemp <= 79) {
    ledStatus = 2;
} else {
    ledStatus = 3;
}

Apply LED mode
if (ledStatus == 0) {
    setOff();
} else if (ledStatus == 1) {
    blinkSlow();
} else if (ledStatus == 2) {
    blinkFast();
} else {
    setOn();
}

writeFile(const std::string& path, const std::string& value)
{
    std::ofstream ofs(path);
    if (!ofs) return false;
    ofs << value;
    return bool(ofs);
}
setOff()
{
    writeFile("/sys/class/leds/am62-sk:green:heartbeat/" + "trigger", "none");
    writeFile("/sys/class/leds/am62-sk:green:heartbeat/" + "brightness", "0");
}
blinkSlow()
{
    writeFile("/sys/class/leds/am62-sk:green:heartbeat/" + "trigger", "timer");
    writeFile("/sys/class/leds/am62-sk:green:heartbeat/" + "delay_on", "200");
    writeFile("/sys/class/leds/am62-sk:green:heartbeat/" + "delay_off", "800");
}
blinkFast()
{
    writeFile("/sys/class/leds/am62-sk:green:heartbeat/" + "trigger", "timer");
    writeFile("/sys/class/leds/am62-sk:green:heartbeat/" + "delay_on", "100");
    writeFile("/sys/class/leds/am62-sk:green:heartbeat/" + "delay_off", "100");
}
setOn()
{
    writeFile("/sys/class/leds/am62-sk:green:heartbeat/" + "trigger", "none");
    writeFile("/sys/class/leds/am62-sk:green:heartbeat/" + "brightness", "1");
}

/src/alarm/alarm.cpp // Alarm Controller に該当
/src/alarm/alarm.h // Alarm Controller に該当
/src/interface/main.cpp // Device API に該当
/src/led/LedControl.cpp // LED Driver に該当
/src/led/LedControl.h // LED Driver ("/sys/class/leds/am62-sk:green:heartbeat/"操作) に該当
/src/led/ILedControl.h // LED Driver (unittest mock用) に該当
/static/dashboard.html // Web Dashboard (UI) に該当

ちなみにtempの初期値は20、ledの初期値は0(OFF)
単体テストは済み

システムテスト
テスト観点

システムテスト仕様書の記載項目
システムテスト仕様書には、以下の項目を記載します。
テスト概要： テスト内容について、どのメンバーも理解できるようにシンプルな書式で記載します。
テストの実施環境： 本番環境に近いどのような環境（ハードウェア、ソフトウェアなど）でテストするのかを記載します。
テストケース： どのようなテストを実行し、どのような結果を得ることが目的なのかを記載します。システムテストの基盤となる種類も記載します。
テスト手順： テストケースのプロセスを実際に用いるデータとともに順次記載します。

項目 説明 テスト対象 テストすべき対象
テスト観点(確認内容) そのテストで確認したいこと
テスト条件 与えるデータ、操作方法などのバリエーション
テスト手順 テストで確認すべき結果が出力されるまでの作業手順
期待値 どのような結果になっていれば合格か、期待される結果